<h2>Formulario notas de examen</h2>

<form [formGroup]="examForm" (ngSubmit)="onSubmit()">
  <mat-form-field appearance="outline">
    <mat-label>Cursada Aprobada</mat-label>
    <select matNativeControl formControlName="examTableId" required>
      <option [value]="0" disabled>Seleccione una cursada aprobada</option>
      <option *ngFor="let m of materiasAprobadas()" [value]="m.id">
        {{ m.name }}
      </option>
    </select>

    <mat-error *ngIf="examForm.get('examTableId')?.hasError('required') && examForm.get('examTableId')?.touched">
      La cursada es obligatoria
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Nota</mat-label>
    <input
      matInput
      type="number"
      formControlName="nota"
      min="0"
      max="10"
      step="1"
      [disabled]="!isNotaEnabled()"
    />
    <mat-hint>{{ getNotaHint() }}</mat-hint>
    <mat-error *ngIf="examForm.get('nota')?.hasError('min')">La nota no puede ser menor a 0</mat-error>
    <mat-error *ngIf="examForm.get('nota')?.hasError('max')">La nota no puede ser mayor a 10</mat-error>
  </mat-form-field>

  <div class="actions">
    <button mat-raised-button color="primary" type="submit">
      {{ editingId() ? 'Actualizar' : 'Guardar' }}
    </button>

    <button *ngIf="editingId()" mat-stroked-button type="button" (click)="onCancelEdit()">
      Cancelar
    </button>
  </div>
</form>

<div
  *ngIf="alert()"
  class="status-container"
  [ngClass]="{
    'success-msg': alert()?.type === 'success',
    'error-msg': alert()?.type === 'error'
  }"
>
  {{ alert()?.text }}
</div>

<h3 class="subtitulo">Notas cargadas</h3>

<div class="grades-list" *ngIf="examGradesRows().length; else emptyGrades">
  <div class="grade-row" *ngFor="let row of examGradesRows()">
    <div class="left">
      <div class="materia">{{ row.materia }}</div>
      <div class="meta">Nota: <b>{{ row.nota }}</b> | Resultado: {{ row.resultado }}</div>
    </div>

    <div class="right">
      <button mat-stroked-button type="button" (click)="onEdit(row)">Editar</button>
      <button mat-stroked-button color="warn" type="button" (click)="onDelete(row)">Eliminar</button>
    </div>
  </div>
</div>

<ng-template #emptyGrades>
  <div class="empty">Todav√≠a no hay notas de examen cargadas para este alumno.</div>
</ng-template>
